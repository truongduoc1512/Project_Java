<div
  style="height: 125px"
  th:fragment="layout-navbar"
  class="container-fluid position-relative p-0"
>
  <nav
    class="navbar navbar-expand-lg navbar-light px-4 px-lg-5 py-3 py-lg-0"
    style="background-color: #E8E8E8;"
  >
    <a href="index.html" class="navbar-brand p-0">
      <h1 class="text-primary m-0">
        <img
          src="../assets/img/logo.png"
          alt=""
          style="margin: 10px 0 10px 20px; max-height: none; height: 100px"
          ;
        />
      </h1>
    </a>
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarCollapse"
    >
      <span class="fa fa-bars"></span>
    </button>
    <div class="navbar-collapse" id="navbarCollapse">
      <div class="navbar-nav ms-auto py-0">
        <a href="#" class="nav-item nav-link active">Trang ch·ªß</a>
        <a href="#" class="nav-item nav-link">D·ªãch v·ª• ti√™m ch·ªßng</a>
        <a href="#" class="nav-item nav-link">B·∫£ng gi√°</a>
        <a href="#" class="nav-item nav-link">C·∫©m nang ti√™m ch·ªßng</a>
        <a href="#" class="nav-item nav-link">G√≥i vaccine</a>
        <a href="#" class="nav-item nav-link">Tin t·ª©c</a>
      </div>
      <a
        href="#"
        class="btn btn-primary rounded-pill text-white py-2 px-4 flex-wrap flex-sm-shrink-0"
        data-bs-toggle="modal"
        data-bs-target="#authModal"
        >ƒêƒÉng nh·∫≠p v√† ƒê·∫∑t l·ªãch</a
      >
    </div>
  </nav>

  <!-- Carousel Start -->

  <!-- Carousel End -->
  <!-- Modal ƒêƒÉng nh·∫≠p & ƒêƒÉng k√Ω -->
  <div
    class="modal fade"
    id="authModal"
    tabindex="-1"
    aria-labelledby="authModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="authModalLabel">ƒêƒÉng nh·∫≠p</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <!-- Tabs -->
          <ul class="nav nav-tabs" id="authTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="login-tab"
                data-bs-toggle="tab"
                data-bs-target="#login"
                type="button"
                role="tab"
              >
                ƒêƒÉng nh·∫≠p
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="register-tab"
                data-bs-toggle="tab"
                data-bs-target="#register"
                type="button"
                role="tab"
              >
                ƒêƒÉng k√Ω
              </button>
            </li>
          </ul>

          <!-- N·ªôi dung ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω -->
          <div class="tab-content mt-3" id="authTabsContent">
            <!-- Form ƒêƒÉng nh·∫≠p -->
            <div class="tab-pane fade show active" id="login" role="tabpanel">
              <form id="loginForm">
                <div class="mb-3">
                  <label for="login-email" class="form-label">Email</label>
                  <input
                    type="email"
                    class="form-control"
                    id="login-email"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="login-password" class="form-label"
                    >M·∫≠t kh·∫©u</label
                  >
                  <input
                    type="password"
                    class="form-control"
                    id="login-password"
                    required
                  />
                </div>
                <button
                  type="submit"
                  class="btn btn-primary button-modal-hover w-100"
                >
                  ƒêƒÉng nh·∫≠p
                </button>
              </form>
            </div>

            <!-- Form ƒêƒÉng k√Ω -->
            <div class="tab-pane fade" id="register" role="tabpanel">
              <form id="registerForm">
                <div class="mb-3">
                  <label for="register-name" class="form-label"
                    >H·ªç v√† t√™n ph·ª• huynh</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="register-name"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="register-email" class="form-label">Email</label>
                  <input
                    type="email"
                    class="form-control"
                    id="register-email"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="register-phone" class="form-label"
                    >S·ªë ƒëi·ªán tho·∫°i</label
                  >
                  <input
                    type="tel"
                    class="form-control"
                    id="register-phone"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="register-password" class="form-label"
                    >M·∫≠t kh·∫©u</label
                  >
                  <input
                    type="password"
                    class="form-control"
                    id="register-password"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="register-confirm-password" class="form-label"
                    >X√°c nh·∫≠n m·∫≠t kh·∫©u</label
                  >
                  <input
                    type="password"
                    class="form-control"
                    id="register-confirm-password"
                    required
                  />
                </div>
                <button
                  type="submit"
                  class="btn btn-primary button-modal-hover w-100"
                >
                  ƒêƒÉng k√Ω
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
      <!-- Modal th√¥ng b√°o l·ªói ƒëƒÉng nh·∫≠p -->
      <div class="modal fade" id="loginErrorModal" tabindex="-1" aria-labelledby="loginErrorModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header bg-danger text-white">
              <h5 class="modal-title" id="loginErrorModalLabel" style="color: white;">L·ªói ƒëƒÉng nh·∫≠p</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
            </div>
            <div class="modal-body">
              Sai email ho·∫∑c m·∫≠t kh·∫©u. Vui l√≤ng th·ª≠ l·∫°i.
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
            </div>
          </div>
        </div>
      </div>
      <script th:inline="javascript">
        document.addEventListener("DOMContentLoaded", function () {
         // X·ª≠ l√Ω ƒëƒÉng nh·∫≠p
        document.getElementById("loginForm").addEventListener("submit", function (e) {
          e.preventDefault();

          const email = document.getElementById("login-email").value;
          const password = document.getElementById("login-password").value;

          const loginData = { email, password };

          fetch("/api/auth/login", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(loginData),
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error("ƒêƒÉng nh·∫≠p th·∫•t b·∫°i");
              }
              return response.json();
            })
            .then((data) => {
              console.log("D·ªØ li·ªáu t·ª´ API:", data); // üëà Xem log ki·ªÉm tra

              if (data.token) {
                // L∆∞u th√¥ng tin v√†o localStorage
                localStorage.setItem("token", data.token);

                // N·∫øu API tr·∫£ v·ªÅ email ·ªü ngo√†i
                if (data.email) {
                  localStorage.setItem("email", data.email);
                }

                // N·∫øu API tr·∫£ v·ªÅ user object
                if (data.user) {
                  localStorage.setItem("currentUser", JSON.stringify(data.user));
                  if (!data.email && data.user.email) {
                    localStorage.setItem("email", data.user.email);
                  }
                }

                // Chuy·ªÉn trang
                if (email === "admin@gmail.com") {
                  window.location.href = "/admin"; // ‚úÖ Chuy·ªÉn ƒë·∫øn trang admin
                } else {
                  window.location.href = "/indexLogin"; // ‚úÖ Chuy·ªÉn ƒë·∫øn trang ng∆∞·ªùi d√πng
                }
              }
            })
            .catch(error => {
              console.error("L·ªói ƒëƒÉng nh·∫≠p:", error);
              var myModal = new bootstrap.Modal(document.getElementById('loginErrorModal'));
              myModal.show();
            });
        });
          // X·ª≠ l√Ω ƒëƒÉng k√Ω
          document.getElementById("registerForm").addEventListener("submit", function (e) {
            e.preventDefault();
      
            const password = document.getElementById("register-password").value;
            const confirmPassword = document.getElementById("register-confirm-password").value;
      
            if (password !== confirmPassword) {
              alert("M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp!");
              return;
            }
      
            const registerData = {
              fullName: document.getElementById("register-name").value,
              email: document.getElementById("register-email").value,
              phone: document.getElementById("register-phone").value,
              password: password,
            };
      
            fetch("/api/auth/register", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(registerData),
            })
              .then((response) => {
                if (!response.ok) {
                  throw new Error("ƒêƒÉng k√Ω th·∫•t b·∫°i");
                }
                return response.json();
              })
              .then((data) => {
                if (data.token) {
                  localStorage.setItem("token", data.token);
                  location.reload(); // ƒêƒÉng k√Ω xong reload ƒë·ªÉ chuy·ªÉn sang login
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                alert("ƒêƒÉng k√Ω th·∫•t b·∫°i: " + error.message);
              });
          });
        });
      </script>
      
</div>
